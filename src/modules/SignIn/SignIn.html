<h1>{{ translate.t('signin:formTitle') }}</h1>

<p>{{ formIntro }}</p>

<form on:submit='handleSubmit(event)'>
    <input type='text' placeholder='username' bind:value='credentials.username'>
    <input type='password' placeholder='password' bind:value='credentials.password'>
    <button type='submit'>Sign in</button>
</form>

<script>
  import './locales';
  import auth from '../../services/auth';
  import router from '../../services/router';
  import translate from '../../services/translate';

  export default {
    data() {
      return {
        formIntro: '',
        credentials: {
          username: '',
          password: ''
        }
      }
    },
    oncreate() {
      this.set({
        formIntro: translate.t('signin:formIntro')
      });
    },
    methods: {
      handleSubmit(event) {
        event.preventDefault();

        auth.authenticate(this.get('credentials'))
          .then((response) => {
            if(response.status !== 200) {
              return;
            }

            response.text().then((data) => {
              auth.setToken(data.access_token);
              router.go('app.dashboard');
            });

          }).catch(() => {

        });
      }
    },
    helpers: {
      translate
    }
  }
</script>
